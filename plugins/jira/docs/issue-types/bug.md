<!-- Generated by Claude Sonnet 4.5 (Anthropic) - December 2025 -->

# Bug Guide

Guide on Jira Bugs: how to write effective bug reports with complete information for resolution.

## Usage

```bash
# Create a bug (most commonly uses project-specific template like ocpbugs-bug)
/jira:create bug OCPBUGS "API server crashes on node deletion"

# Override with a specific template
/jira:create bug OCPBUGS "API server crashes" --template common/bug

# RHEL bug
/jira:create bug RHEL "Package install fails on RHEL 9.2"

# OpenShift Docs bug
/jira:create bug OSDOCS "Missing documentation for new feature"
```

**Templates:** For more information on templates, see the [Template Guide](../../templates/README.md).

---

## What is a Bug Report?

A bug report is:
- **Documentation of a problem** - Something doesn't work as expected
- **Communication tool** - Helps developers understand and fix the issue
- **Evidence of defect** - Demonstrates the problem exists
- **Reproduction guide** - Enables others to see the same issue

### Good Bug Reports Are:

- **Specific** - Clearly identifies the problem
- **Complete** - Contains all information needed to understand and reproduce
- **Reproducible** - Provides steps to trigger the issue
- **Actionable** - Developers can act on it immediately

## Complete Bug Report

A good bug report contains these essential elements:

### 1. Clear Summary

Brief description that identifies the problem (one sentence, 5-10 words)

**Examples:**
- ✅ "API server returns 500 error when creating namespaces"
- ✅ "Control plane pods crash on upgrade from 4.20 to 4.21"
- ✅ "Memory leak in etcd container after 24 hours"

### 2. Detailed Description

Complete context and background about the issue

### 3. Reproducibility

How often the bug occurs:
- **Always** - Happens every time following the steps
- **Sometimes** - Happens intermittently, even with same steps
- **Rarely** - Hard to reproduce, happened once or few times

### 4. Steps to Reproduce

Exact sequence of actions that trigger the bug

### 5. Actual Results

What actually happens (include error messages)

### 6. Expected Results

What should happen instead

### 7. Environment Details

Version, platform, configuration where bug occurs

### 8. Additional Context

Logs, screenshots, error messages, workarounds

**Template:** See [common/bug.yaml](../../templates/common/bug.yaml) for the structured template format.

---

## Best Practices

### 1. Clear and Specific Summary

The summary should:
- Be concise (one sentence)
- Identify the problem clearly
- Include key context when helpful
- Avoid vague terms like "broken" or "doesn't work"

**Good examples:**
- ✅ "API server returns 500 error when creating namespaces"
- ✅ "Control plane pods crash on upgrade from 4.20 to 4.21"
- ✅ "Memory leak in etcd container after 24 hours"
- ✅ "Login button unresponsive on iOS mobile app"

**Bad examples:**
- ❌ "Things are broken" (too vague)
- ❌ "Error in production" (not specific)
- ❌ "Fix the bug" (not a summary)
- ❌ "Doesn't work" (missing context)

### 2. Complete Problem Description

Provide context about the issue:
- What were you trying to do?
- What component or feature is affected?
- Who is affected? How severe is it?
- When did this start happening?

**Example:**
```text
The kube-apiserver pod crashes immediately after upgrading a hosted control
plane cluster from version 4.20 to 4.21. The pod enters CrashLoopBackOff
state and all API requests to the cluster fail. This affects all production
ROSA HCP clusters attempting to upgrade.
```

### 3. Precise Steps to Reproduce

Be exact and specific:
- Number each step
- Use exact commands, button clicks, inputs
- Include environment setup if needed
- Use code blocks for commands
- Mention any prerequisites

**Example:**
```text
Steps to Reproduce:
1. Create a ROSA HCP cluster on version 4.20.0:
   rosa create cluster --name test-cluster --version 4.20.0 --hosted-cp
2. Wait for cluster to be fully ready (about 15 minutes)
3. Initiate upgrade to 4.21.0:
   rosa upgrade cluster --cluster test-cluster --version 4.21.0
4. Monitor the control plane pods:
   oc get pods -n clusters-test-cluster -w
5. Observe kube-apiserver pod status
```

**Tips:**
- Start from a clean state if possible
- Include exact commands with parameters
- Specify timing (immediate, after 5 minutes, etc.)
- Note any expected waits or delays

### 4. Detailed Actual Results

Describe exactly what occurs:
- Include full error messages (not paraphrased)
- Mention symptoms (crashes, hangs, wrong output)
- Include relevant logs or stack traces
- Note timing and frequency

**Example:**
```text
Actual results:
The kube-apiserver pod crashes immediately after the upgrade completes.
The pod restarts continuously (CrashLoopBackOff). Error in pod logs:

panic: runtime error: invalid memory address or nil pointer dereference
[signal SIGSEGV: segmentation violation code=0x1 addr=0x0 pc=0x...]
goroutine 1 [running]:
main.setupServer(...)
  /go/src/apiserver/server.go:123

API requests to the cluster fail with:
Error from server: error dialing backend: dial tcp: lookup kube-apiserver: no such host
```

### 5. Clear Expected Results

Describe the correct behavior:
- State what should happen
- Be specific about expected state/output
- Contrast with actual results

**Example:**
```text
Expected results:
The kube-apiserver pod should start successfully after the upgrade. The pod
should be in Running state with 1/1 containers ready. API requests to the
cluster should succeed normally without any connection errors.
```

### 6. Include Environment Details

Specify version and environment:
- Product version (e.g., OpenShift 4.21.0)
- Component version if different
- Platform (AWS, Azure, GCP, bare metal)
- Region or availability zone
- Configuration details (cluster size, networking mode, etc.)

**Example:**
```text
Version-Release number: OpenShift 4.21.0
Platform: ROSA HCP on AWS
Region: us-east-1
Cluster configuration: 3 control plane nodes, 5 worker nodes
```

### 7. Add Helpful Context

Include additional information:
- Full logs or log excerpts
- Screenshots or screen recordings
- Stack traces
- Related Jira issues or GitHub issues
- Workarounds discovered
- Impact assessment (severity, affected users, frequency)

**Example:**
```text
Additional info:
- Cluster ID: abc123-def456
- Full pod logs: See attached kube-apiserver.log
- Related issue: OCPBUGS-12340 (similar crash in 4.19→4.20 upgrade)
- Workaround: Rollback to 4.20.0 and cluster recovers immediately
- Impact: Affects all ROSA HCP production clusters attempting 4.20→4.21 upgrade
- Frequency: 100% reproduction rate (tested on 5 clusters)
```

### 8. Sanitize Sensitive Data

**CRITICAL:** Never include:
- ❌ API keys, tokens, passwords
- ❌ Customer names or identifiable information
- ❌ Internal IP addresses (redact or use placeholders)
- ❌ Cluster IDs in public issues (if sensitive)

**Instead:**
- ✅ Use placeholders: `YOUR_API_KEY`, `<redacted>`, `10.x.x.x`
- ✅ Sanitize logs before attaching
- ✅ Blur sensitive parts of screenshots

## Bug Quality Checklist

Before creating a bug, verify:

- ✅ Summary is clear and identifies the problem
- ✅ Problem description provides complete context
- ✅ Reproducibility level specified (Always/Sometimes/Rarely)
- ✅ Steps to reproduce are specific and numbered
- ✅ Actual results include error messages
- ✅ Expected results clearly stated
- ✅ Version information provided
- ✅ No sensitive data (credentials, secrets, tokens)
- ✅ Logs are sanitized
- ✅ Additional context included (if available)

## Anti-Patterns to Avoid

### ❌ Vague or Generic Summary

**Examples:**
```text
"Things are broken"
"Error in production"
"Fix the bug"
"Something doesn't work"
```

**Why bad:** Doesn't identify the problem, not searchable, not actionable

**Fix:** Be specific:
```text
"API server returns 500 error when creating namespaces"
"Memory leak in etcd container after 24 hours"
"Login button unresponsive on iOS devices"
```

---

### ❌ Missing Steps to Reproduce

**Example:**
```text
Description: The application crashes.

Steps to Reproduce: It just crashes sometimes.
```

**Why bad:** Developers can't reproduce, can't debug, can't verify fix

**Fix:** Provide exact steps:
```text
Steps to Reproduce:
1. Launch application
2. Navigate to Settings > Profile
3. Click "Delete Account" button
4. Confirm deletion in popup
5. Application crashes with SIGSEGV
```

---

### ❌ "Works on My Machine" Anti-Information

**Example:**
```text
It works fine for me, not sure why it's broken for you.
```

**Why bad:** Doesn't help solve the problem, dismissive

**Fix:** Provide environment comparison:
```text
Environment where it works:
- Version 4.20.5
- Platform: AWS us-west-2
- Configuration: default settings

Environment where it fails:
- Version 4.21.0
- Platform: AWS us-east-1
- Configuration: custom VPC with proxy
```

---

### ❌ Paraphrased or Incomplete Error Messages

**Example:**
```text
Actual results: Got an error about memory or something.
```

**Why bad:** Lost critical debugging information

**Fix:** Include full error message:
```text
Actual results:
panic: runtime error: invalid memory address or nil pointer dereference
[signal SIGSEGV: segmentation violation code=0x1 addr=0x0 pc=0x4b3c12]
```

---

### ❌ No Expected Results

**Example:**
```text
Steps to Reproduce: <provided>
Actual results: Application crashes

Expected results: <empty>
```

**Why bad:** Unclear if behavior is actually wrong, might be expected

**Fix:** State expected behavior:
```text
Expected results:
Application should save the profile changes and return to the main menu
without crashing.
```

---

### ❌ Combining Multiple Bugs

**Example:**
```text
Summary: "Multiple issues found in testing"

Description:
1. Login doesn't work
2. Search is slow
3. Export crashes
4. Settings won't save
```

**Why bad:** Different root causes, different fixes, hard to track, can't close until all fixed

**Fix:** Create separate bugs:
- Bug 1: "Login fails with 'invalid credentials' error for valid users"
- Bug 2: "Search query takes >30 seconds for simple terms"
- Bug 3: "Export to CSV crashes with out of memory error"
- Bug 4: "Settings revert to defaults after application restart"

---

### ❌ Sensitive Data in Bug Report

**Example:**
```text
Steps to Reproduce:
1. Login with username: admin@company.com, password: MySecretPass123
2. Use API key: sk-1234567890abcdef
3. Connect to database: postgresql://user:pass@10.52.3.45:5432/prod
```

**Why bad:** Security risk, credentials exposed

**Fix:** Use placeholders:
```text
Steps to Reproduce:
1. Login with admin credentials
2. Use valid API key
3. Connect to production database
```

## Examples

### Example 1: Infrastructure Bug

**Summary:** "Control plane pods crash on upgrade from 4.20 to 4.21"

**Description:**
```text
Description of problem:
The kube-apiserver pod crashes immediately after upgrading a hosted control
plane cluster from version 4.20 to 4.21. The pod enters CrashLoopBackOff
state and all API requests to the cluster fail.

Version-Release number: OpenShift 4.21.0

How reproducible: Always

Steps to Reproduce:
1. Create a ROSA HCP cluster on version 4.20.0:
   rosa create cluster --name test-cluster --version 4.20.0 --hosted-cp
2. Wait for cluster to be fully ready (verify with: rosa describe cluster test-cluster)
3. Initiate upgrade to 4.21.0:
   rosa upgrade cluster --cluster test-cluster --version 4.21.0
4. Monitor the control plane pods:
   oc get pods -n clusters-test-cluster -w
5. Observe kube-apiserver pod status after upgrade completes (about 10 minutes)

Actual results:
The kube-apiserver pod crashes immediately after the upgrade completes. The pod
restarts continuously (CrashLoopBackOff state). Error in pod logs:

panic: runtime error: invalid memory address or nil pointer dereference
[signal SIGSEGV: segmentation violation code=0x1 addr=0x0 pc=0x4b3c12]
goroutine 1 [running]:
k8s.io/apiserver/pkg/server.setupMetrics(...)
  /go/src/k8s.io/apiserver/pkg/server/server.go:245

API requests to the cluster fail with:
Error from server: error dialing backend: dial tcp: lookup kube-apiserver on 10.0.0.2:53: no such host

Expected results:
The kube-apiserver pod should start successfully after the upgrade. The pod
should be in Running state (1/1 containers ready). API requests to the cluster
should succeed normally.

Additional info:
- Platform: ROSA HCP on AWS
- Region: us-east-1
- Cluster ID: abc123-def456
- Full pod logs attached: kube-apiserver-crash.log
- Related issue: OCPBUGS-12340 (similar crash during 4.19→4.20 upgrade)
- Workaround: Rollback to 4.20.0 restores cluster functionality immediately
- Impact: Blocks all ROSA HCP clusters from upgrading to 4.21
- Tested on: 5 different clusters, 100% reproduction rate
```

---

### Example 2: UI Bug

**Summary:** "Login button unresponsive on iOS mobile app"

**Description:**
```text
Description of problem:
The login button on the mobile app doesn't respond to taps on iOS devices.
Users cannot proceed past the login screen to enter credentials.

Version-Release number: Mobile App v2.1.0 (build 145)

How reproducible: Always

Steps to Reproduce:
1. Install mobile app version 2.1.0 on iPhone 13 running iOS 16.5
2. Launch the app
3. Navigate to the login screen (displayed by default on first launch)
4. Tap the "Login" button
5. Observe no response

Actual results:
The "Login" button does not respond to taps. There is no visual feedback
(button doesn't change color or animate), and no navigation occurs. The app
remains on the login welcome screen.

Tested with:
- Single tap: no response
- Double tap: no response
- Long press: no response

Expected results:
The "Login" button should respond to tap with visual feedback (button color
change or animation) and navigate to the credentials input screen where users
can enter username and password.

Additional info:
- Platform affected: iOS only (iPhone 13, iOS 16.5)
- Platform working: Android app (same version) works correctly
- Also tested on: iPad Pro (iOS 16.4) - same issue
- Screen recording attached: ios-login-bug.mov
- Accessibility: VoiceOver reads button correctly but activation doesn't work
- Workaround: None found - users cannot log in on iOS
- Impact: All iOS users cannot access the app (critical)
```

---

### Example 3: Intermittent Bug

**Summary:** "Intermittent 500 errors from API server during node scaling"

**Description:**
```text
Description of problem:
When scaling node pools up or down, the API server intermittently returns
500 Internal Server Error for approximately 5-10 seconds. Errors affect
random API calls during the scaling operation.

Version-Release number: OpenShift 4.21.0

How reproducible: Sometimes (approximately 30% of scaling operations)

Steps to Reproduce:
1. Create a ROSA HCP cluster with a node pool
2. Scale the node pool from 3 to 10 nodes:
   rosa edit machinepool --cluster test-cluster --replicas 10 default
3. Continuously query API during scaling (in another terminal):
   while true; do oc get nodes; sleep 1; done
4. Observe intermittent errors during the scaling operation

Actual results:
During node scaling (both up and down), API requests intermittently fail with
500 errors for 5-10 seconds:

Error from server (InternalError): an error on the server ("") has prevented
the request from succeeding (get nodes)

API server logs show:
E1215 14:23:45.123456  1 controller.go:256] Failed to sync nodes:
  panic: runtime error: index out of range [5] with length 3

Errors occur randomly:
- Sometimes on "get nodes"
- Sometimes on "get pods"
- Sometimes on "get namespaces"
- No pattern to which API calls fail

Frequency: Errors occur in ~30% of scaling operations (tested 20 times, errors
in 6 operations)

Expected results:
All API requests should succeed during node scaling operations. The API server
should handle scaling operations gracefully without returning 500 errors.

Additional info:
- Timing: Errors occur 30-60 seconds after scaling command issued
- Duration: Errors last 5-10 seconds, then API returns to normal
- Scale direction: Affects both scale-up and scale-down operations
- Node pool size: Tested with pools scaling from 3→10, 5→15, 10→3
- API server logs attached: apiserver-scaling-errors.log
- Impact: Automation scripts fail during scaling, require retry logic
- Workaround: Implement retry logic with exponential backoff
- Frequency: 30% of scaling operations (6 out of 20 tests)
- Related: OCPBUGS-11111 (similar intermittent 500 errors during upgrades)
```

## Related

- [Story Guide](story.md) - Creating user stories for new functionality
- [Task Guide](task.md) - Creating tasks for technical work
- [Template Reference](../../templates/common/bug.yaml) - Bug template used by `/jira:create bug`
