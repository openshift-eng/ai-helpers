---
name: Template Management
description: Implementation guide for Jira issue templates
---
<!-- Generated by Claude Sonnet 4.5 (Anthropic) - December 2025 -->

# Template Management

Guide for `/jira:template` command and template integration with `jira:create`.

## Template Inheritance

Templates use inheritance to reduce duplication:

```text
_base.yaml                     # Shared defaults (priority, labels, display_format)
  └── common/<type>.yaml       # Issue-type templates (story, bug, epic, task, spike, feature)
        ├── common/<project>-<type>.yaml   # Project-specific (ocpbugs-bug, osdocs-bug, rhel-bug, rfe)
        └── <team>/<type>.yaml             # Team-specific (ocpedge/story, ocpedge/bug)
              └── user/<custom>.yaml       # Personal templates (gitignored)
```

**Inheritance rules:**
- Child templates override parent fields
- `defaults.labels` replaces parent (include `ai-generated-jira` + `template:<name>`)
- `placeholders` replaces parent (include all needed placeholders)
- `display_format` replaces parent
- Unspecified fields inherit from parent

## Template Directories

| Location | Purpose | Git Tracking |
|----------|---------|--------------|
| `templates/_base.yaml` | Shared defaults for all templates | ✅ Published |
| `templates/common/` | Base issue-type and common project templates | ✅ Published |
| `templates/<team>/` | Team-specific templates (ocpedge, hypershift) | ✅ Published |
| `templates/user/` | Personal templates | ❌ Gitignored |

## Published Template Requirements

Templates outside `user/` directory **MUST** have:

| Field | Description | Example |
|-------|-------------|---------|
| `version` | Semantic version | `1.0.0` |
| `created` | ISO date | `2025-01-08` |
| `author` | GitHub org or username | `openshift-eng` |
| `source.repository` | Full repository URL | `https://github.com/openshift-eng/ai-helpers` |
| `source.path` | Path within repository | `plugins/jira/templates/ocpedge/story.yaml` |

The `publish` action adds these fields. The `validate` action checks them.

## Template Selection Algorithm

Used by `jira:create` when `--template` is specified or for auto-selection:

1. **If `--template <name>` provided:**
   - Load specified template
   - Validate `issue_type` matches command type
   - Warn if mismatch

2. **If no template specified, auto-select:**
   - Check team directory first: `<project-lower>/<type>.yaml`
   - Fall back to common: `common/<type>.yaml`
   - Confirm with user: "Using template: `<name>`. Proceed? (Y/n)"

3. **Template type validation:**
   - Template's `issue_type` must match command type
   - Case-insensitive comparison
   - `feature-request` command matches `Feature Request` template

## Template Format

```yaml
# Required: inheritance
inherits: common/story.yaml    # or _base.yaml for common templates

# Required: identity
name: ocpedge-story
description: Story template for OCPEDGE project
issue_type: Story

# Required for published templates
version: 1.0.0
created: 2025-01-08
author: openshift-eng
source:
  repository: "https://github.com/openshift-eng/ai-helpers"
  path: "plugins/jira/templates/ocpedge/story.yaml"

# Optional: target project (omit for common templates)
project_key: OCPEDGE

# Override defaults
defaults:
  components:
    - MicroShift
  labels:
    - ai-generated-jira
    - template:ocpedge-story

# Override display format
display_format:
  - priority
  - summary
  - assignee
  - status

# Issue description template with placeholders
description_template: |
  As a {{user_role}}, I want to {{action}}, so that {{value}}.
  ...

# Placeholder definitions
placeholders:
  - name: user_role
    description: "Who is the user?"
    required: true
  - name: acceptance_criteria
    description: "Acceptance criteria (one per line)"
    required: true
    type: list
```

## Template Actions

| Action | Description |
|--------|-------------|
| `create` | Create new template interactively → saves to `user/` |
| `create-from <base>` | Create from existing template with prefix → saves to `user/` |
| `publish <name>` | Add source metadata, move from `user/` to published location |
| `list` | List available templates with source type |
| `show <name>` | Display template configuration |
| `edit <name>` | Modify template fields |
| `delete <name>` | Remove template |
| `validate <name>` | Check template against Jira and metadata requirements |

## Validate Action

The `validate` action performs comprehensive template validation using the `validate_template.py` script.

### How to Use

```bash
# Validate a template
/jira:template validate ocpedge-spike

# Or run the script directly
python3 plugins/jira/templates/validate_template.py ocpedge/spike.yaml
```

### Validation Phases

The validator runs four validation phases:

#### Phase 1: YAML Syntax
- **Check:** Valid YAML syntax
- **Errors:** Parse errors with line and column numbers
- **Example error:**
  ```text
  YAML Parse Error: Line 45, Column 3: unexpected indent
  ```

#### Phase 2: Schema Validation
- **Check:** Required fields present (with inheritance support)
- **Required fields:** `name`, `description`, `version`, `issue_type`
- **Inheritance:** Fields inherited from parent templates count as present
- **Example:** `ocpedge/spike.yaml` inherits `issue_type: Spike` from `common/spike.yaml`
- **Errors:**
  ```text
  Missing required fields: issue_type, version
  ```

#### Phase 3: Placeholder References
- **Check:** All placeholders in `description_template` are defined
- **Supports:** Regular placeholders (`{{name}}`) and sections (`{{#list}}`)
- **Includes:** Parent placeholder definitions in inheritance chain
- **Supports:** `placeholder_name` pattern for output-only placeholders
- **Errors:**
  ```text
  Undefined placeholders in description_template: missing_field, unknown_var
  ```

#### Phase 4: Inheritance Validation
- **Check:** No circular inheritance
- **Detects:** Direct cycles (A→B→A) and indirect cycles (A→B→C→A)
- **Displays:** Full inheritance chain for valid templates
- **Errors:**
  ```text
  Circular inheritance detected: team/epic.yaml → common/epic.yaml → team/epic.yaml
  ```

### Validation Output

**Success:**
```text
Validating: ocpedge/spike.yaml

✓ YAML syntax valid
✓ Schema validation passed
  - name: ocpedge-spike
  - issue_type: Spike
  - 5 placeholders defined
✓ Placeholder references valid
  Uses: overview, research_questions, involved_teams, ...
  All defined
✓ Inheritance chain valid
  ocpedge/spike.yaml → common/spike.yaml → _base.yaml

✅ Template is valid and ready to use.
```

**Failure:**
```text
Validating: broken-template.yaml

✓ YAML syntax valid
✗ Schema validation failed
  Missing required fields: issue_type
✗ Placeholder reference error
  Template uses: undefined_field
  But placeholders not defined
✓ Inheritance chain valid

❌ Template has 2 error(s):
   - Missing required fields: issue_type
   - Undefined placeholders in description_template: undefined_field

Template validation failed. Fix errors before using this template.
```

### Validation Rules

**All templates:**
- Required fields: `name`, `description`, `version`, `issue_type`
- Labels should include `template:<name>` (convention)
- Placeholders referenced in `description_template` must be defined
- No circular inheritance

**Published templates (not in `user/`):**
- Must have `version`, `created`, `author`
- Must have `source.repository` and `source.path`
- `source.path` must match actual file location

**Jira validation (if `project_key` specified):**
- Project exists
- Issue type exists in project
- Components exist (if specified)

## Error Handling

| Error | Action |
|-------|--------|
| Template not found | List available templates |
| Type mismatch | Warn user, ask to proceed or abort |
| Missing source metadata | Error for published, OK for user templates |
| Invalid Jira fields | Show available options |
